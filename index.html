<!DOCTYPE html>
<html lang="en">

<head>
    <title>SEETARD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>
    <script src="jquery-3.4.1.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <style>
        body {
            display: none;
        }
    </style>
    <script>
        // Model URL
        // Initialize the Image Classifier method with MobileNet
        const classifier = ml5.imageClassifier('https://teachablemachine.withgoogle.com/models/N3z7R3b1n/model.json', modelLoaded);
        // When the model is loaded
        function modelLoaded() {
            console.log('Model Loaded!');
            $("body").fadeIn(1000);
        };

        $(document).ready(function () {
            $("#uploadButton").hide();
            $("#filePreview").hide();
            $("#endResult").hide();
        });
    </script>
</head>

<body>
    <div class="text-center">
        <h1>Welcome to SeeTard</h1>
        <hr />
        <div>
            <img class="img-thumbnail" id='filePreview' src="" height="200" alt="Image preview..."
                style="max-height:200px"><br>
            <label for='file'>Choose an image from your device</label>
            <input id='file' type='file' accept="image/*" capture="camera" /><br>
            <button class="btn btn-primary" id='uploadButton' type='button' onclick="uploadFile()">Submit</button>
        </div>
        <div>
            <p id="endResult"></p>
        </div>
    </div>
</body>
<script>
    $("#file").on("change", function () {
        var preview = document.querySelector('img');
        var file = document.querySelector('input[type=file]').files[0];
        var reader = new FileReader();

        reader.onloadend = function () {
            preview.src = reader.result;
        }

        if (file) {
            reader.readAsDataURL(file);
        } else {
            preview.src = "";
        }
        $("#filePreview").show();
        $("#uploadButton").show();
    });
    const result = document.getElementById('result'); // The result tag in the HTML
    const probability = document.getElementById('probability'); // The probability tag in the HTML
    function uploadFile() {
        // Make a prediction with a selected image
        classifier.classify(document.getElementById('filePreview'), (err, results) => {
            console.log(results);
            var probabilitypercent = (results[0].confidence * 100).toFixed(2)
            endResult.innerText = "You are " + probabilitypercent + "% " + results[0].label + "!";
            $("#endResult").fadeIn(500);
        });
    }
</script>

</html>